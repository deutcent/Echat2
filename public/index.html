<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Echat</title>
  <style>
    /* [Same styling as before, unchanged for brevity] */
    /* Add styling for document links */
    .download-link {
      display: block;
      margin-top: 5px;
      color: #007bff;
      text-decoration: underline;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <header>
      Echat
      <span id="online-count">Online: 0</span>
    </header>
    <div id="user-list">Users:</div>
    <div id="messages"></div>
    <form id="form">
      <label for="image-input">ðŸ“·</label>
      <input type="file" id="image-input" accept="image/*" style="display:none;">
      <label for="file-input">ðŸ“Ž</label>
      <input type="file" id="file-input" accept=".pdf,.doc,.docx,.txt,.xls,.xlsx,.ppt,.pptx,.csv,.zip" style="display:none;">
      <button type="button" id="voice-btn">ðŸŽ¤</button>
      <input id="input" autocomplete="off" placeholder="Type a message..." required />
      <button type="submit">âž¤</button>
    </form>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let name = '';
    while (!name) {
      name = prompt("Enter your name:");
    }

    socket.emit('user joined', name);

    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const messages = document.getElementById('messages');
    const imageInput = document.getElementById('image-input');
    const fileInput = document.getElementById('file-input');

    function appendMessage(data, isSender = false) {
      const msg = document.createElement('div');
      msg.className = 'message ' + (isSender ? 'sender' : 'receiver');
      msg.innerHTML = `<span class="username">${data.name}</span>${data.message}`;
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }

    function appendImage(data, isSender = false) {
      const msg = document.createElement('div');
      msg.className = 'message ' + (isSender ? 'sender' : 'receiver');
      msg.innerHTML = `<span class="username">${data.name}</span><img class="chat-image" src="${data.url}" alt="Image" />`;
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }

    function appendFile(data, isSender = false) {
      const msg = document.createElement('div');
      msg.className = 'message ' + (isSender ? 'sender' : 'receiver');
      msg.innerHTML = `<span class="username">${data.name}</span><a class="download-link" href="${data.url}" download target="_blank">${data.filename}</a>`;
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      if (input.value) {
        const msg = { name, message: input.value };
        socket.emit('chat message', msg);
        appendMessage(msg, true);
        input.value = '';
      }
    });

    imageInput.addEventListener('change', () => {
      const file = imageInput.files[0];
      if (file) {
        const formData = new FormData();
        formData.append('file', file);
        fetch('/upload', { method: 'POST', body: formData })
          .then(res => res.json())
          .then(data => {
            const msg = { name, url: data.url };
            socket.emit('chat image', msg);
            appendImage(msg, true);
          });
      }
    });

    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (file) {
        const formData = new FormData();
        formData.append('file', file);
        fetch('/upload', { method: 'POST', body: formData })
          .then(res => res.json())
          .then(data => {
            const msg = { name, url: data.url, filename: file.name };
            socket.emit('chat file', msg);
            appendFile(msg, true);
          });
      }
    });

    socket.on('chat message', data => { if (data.name !== name) appendMessage(data); });
    socket.on('chat image', data => { if (data.name !== name) appendImage(data); });
    socket.on('chat file', data => { if (data.name !== name) appendFile(data); });
  </script>
</body>
</html>
